version: '1.0'
stages:
 - clone
 - test
 - build
steps:
  clone:
    title: "Cloning main repository..."
    stage: "clone"
    type: "git-clone"
    arguments:
      repo: "bieli/FreeItLessons"
      revision: "master"
      git: "github"
  run_unit_tests:
     title: "Running unit tests..."
     stage: "test"
     type: "freestyle"
     working_directory: "${{clone}}"
     arguments:
       image: "python:3.8-slim"
       commands:
         - "pip install -r requirements.txt --cache-dir=/codefresh/volume/pip-cache"
         - "python -m unittest tests/*.py"
  build_my_image:
    stage: build
    type: build
    title: Building Docker Image
    working_directory: ${{clone_step_name}}
    dockerfile: Dockerfile
    image_name: bieli/FreeItLessons
    tag: develop
    no_cache: false
    no_cf_cache: false
    tag_policy: original
    fail_fast: false

