{% extends 'mainapp/base.html' %}

{% load bootstrap3 %}

{% block title %}Zadania{% endblock %}


{% block bootstrap3_content %}

<script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
<script language="Javascript" type="text/javascript" src="/static/mainapp/js/jquery.base64.min.js"></script>
<script>
  $.noConflict();
  jQuery( document ).ready(function( $ ) {

  console.log( "ready!" );


  function postDataIntoServiceEndpoint(task_id) {
    var logged_user_id = parseInt($("input[name='logged-user-id']").val());
    var myEvent = { user_id: logged_user_id, task_id: task_id, csrfmiddlewaretoken: '{{ csrf_token }}',
                    code: $.base64.encode($("#source_code_block").val()),
                    tests: $.base64.encode($("#source_tests_block pre code").text())
    };
    console.log("myEvent:", myEvent)
    $.ajax({
        url: 'task/code/run/',
        type: 'POST',
        data: myEvent,
        success: function(result) {
            console.log("postDataIntoServiceEndpoint: AJAX OK - result: ", result);
            $('#program_output').text(result)
        },
        error: function(result) {
            console.log("postDataIntoServiceEndpoint: AJAX ERROR - result: ", result);
        }
    });
  }

  postDataIntoServiceEndpoint(1, "status");
    $('#program_run').click(function(event){
      var target = $( event.target );
      if (target.is("a")) {
        postDataIntoServiceEndpoint("{{ task.id }}");
      }
    });

});
</script>

{% include "header.html" %}
<head>
    <link class="codestyle" rel="prefetch alternate stylesheet" href="https://highlightjs.org/static/demo/styles/vs.css">
    <link class="codestyle" rel="prefetch alternate stylesheet" href="https://highlightjs.org/static/demo/styles/github.css">

    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/styles/default.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/highlight.min.js"></script>
<script>
  function initTestsCode() {
    var testsCode = document.querySelector('#source_tests_block pre code');
    hljs.highlightBlock(testsCode);
    var style = "github";
    var links = "python";
    testsCode.result.language = links;
    Array.prototype.forEach.call(links, function(link) {
      link.rel = 'stylesheet';
      //link.disabled = !link.href.match(style + '\\.css$');
    });
    //document.getElementById('language-link').innerHTML = testsCode.result.language;
  }

  addEventListener('load', initTestsCode);
</script>


	<script language="Javascript" type="text/javascript" src="/static/mainapp/js/edit_area/edit_area_full.js"></script>
	<script language="Javascript" type="text/javascript">
    editAreaLoader.init({
        id: "source_code_block"	// id of the textarea to transform
        //,start_highlight: true	// if start with highlight
        //,font_size: "10"
        ,allow_resize: "yes"
        ,allow_toggle: false
        ,language: "en"
        ,font_size: 10
        ,gecko_spellcheck: false
        ,word_wrap: true
        ,start_highlight: true
        ,syntax: "python"
        //,load_callback: "my_load"
        //,save_callback: "my_save"
        ,display: "onload"
        ,replace_tab_by_spaces: 4
        ,min_height: 250
        //,toolbar: "search, go_to_line, fullscreen, |, undo, redo, |, select_font,|, change_smooth_selection, highlight, reset_highlight, word_wrap, |, help"
        ,toolbar: "search, go_to_line, fullscreen, |, undo, redo, |, select_font,|, change_smooth_selection, highlight, reset_highlight, word_wrap, |, help"
    });
    </script>

</head>

<body style="background: lightgray;">
<div class="container-fluid">
	<div class="row">
		<div class="col-md-12">
            <h2 class="text-info">
				<strong>Zadanie #{{ task.id }} - <i>{{ task.name }}</i></strong>
			</h2>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <h4 class="text-info">
				Cel zadania:
			</h4>
            <blockquote class="text-warning">
                {{ task.desc }}
            </blockquote>
            <hr />
        </div>
    </div>
    <div class="row">
		<div class="col-md-12">
            <a id="program_run" href="#" class="btn btn-success btn-lg btn-block active" type="button">Uruchom program == testuj rozwiązanie</a>
        </div>
    </div>
    <div class="row">
		<div class="col-md-12">
            <textarea id="source_code_block" style="height: 200px; width: 100%;" name="test_4">{{ task.code }}</textarea>
        </div>

    </div>
    <div class="row">
		<div class="col-md-12">
            <div id="source_tests_block">
                <pre><code>{{ task.tests }}</code></pre>
            </div>
    </div>
    <hr />
    <div class="row">
		<div class="col-md-6">
            <h4 class="text-info">
				Wynik działania programu po uruchomieniu:
			</h4>
            <pre id="program_output" style="background: black; color: white; ">
ASSERTS TESTS - OK.
Traceback (most recent call last):
  File "{{ task.name }}.py", line 26, in <module>
    __run_tests()
  File "{{ task.name }}.py", line 16, in __run_tests
    assert 'X' == reverse_chars('X') # ✔
AssertionError
            </pre>
            <br /><br /><br />
        </div>
		<div class="col-md-6">
            <h4 class="text-info">
				Wynik wykonania testów <small>( <i style="color: green;">3</i> z <i style="color: darkred;">3</i> | 50% )</small>:
			</h4>
            <blockquote style="background: green; color: white; ">
                assert 'X' == reverse_chars('X') # ✔
            </blockquote>

            <blockquote style="background: green; color: white; ">
                assert 'X' == reverse_chars('X') # ✔
            </blockquote>

            <blockquote style="background: green; color: white; ">
                assert 'X' == reverse_chars('X') # ✔
            </blockquote>
                        <blockquote style="background: darkred; color: white; ">
                assert 'X' == reverse_chars('X') # x
            </blockquote>

            <blockquote style="background: darkred; color: white; ">
                assert 'X' == reverse_chars('X') # x
            </blockquote>

            <blockquote style="background: darkred; color: white; ">
                assert 'X' == reverse_chars('X') # x
            </blockquote>

            <br /><br /><br />
        </div>
    </div>
    <div class="row">
		<div class="col-md-2">
            <a href="#" class="btn btn-warning btn-lg btn-block" type="button">Poproszę o podpowiedź 1</a>
        </div>
		<div class="col-md-2">
            <a href="#" class="btn btn-warning btn-lg btn-block" type="button">Poproszę o podpowiedź 2</a>
        </div>
		<div class="col-md-2">
            <a href="#" class="btn btn-warning btn-lg btn-block" type="button">Poproszę o podpowiedź 3</a>
        </div>
		<div class="col-md-2">
            <a href="#" class="btn btn-warning btn-lg btn-block" type="button">Poproszę o podpowiedź 4</a>
        </div>
		<div class="col-md-2">
            <a href="#" class="btn btn-warning btn-lg btn-block" type="button">Poproszę o podpowiedź 5</a>
        </div>
		<div class="col-md-2">
            <a href="#" class="btn btn-danger btn-lg btn-block inactive" type="button">Poddaje się !!!</a>
        </div>
        <br /><br /><br />
    </div>
</div>
</body>

{% endblock %}
